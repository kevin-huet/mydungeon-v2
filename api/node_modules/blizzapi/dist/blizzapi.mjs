import M from"axios";const q=e=>e[0]==="/",Q=e=>e.length>3,W=[q,Q],X=e=>W.every(t=>t(e)),Z=e=>/(?:http[s]?:\/\/)[^\s(["<,>]*\.[^\s[",><]*/gm.test(e);var J=Object.defineProperty,Y=Object.prototype.hasOwnProperty,I=Object.getOwnPropertySymbols,ee=Object.prototype.propertyIsEnumerable,L=(e,t,o)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))Y.call(t,o)&&L(e,o,t[o]);if(I)for(var o of I(t))ee.call(t,o)&&L(e,o,t[o]);return e},te=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});const m=e=>te(this,null,function*(){const{uri:t,timeout:o,headers:n,params:s,data:c,auth:l}=e,a=e.method||"GET";if(!Z(t))throw new RangeError(`'${t}' is not a valid parameter for fetchFromUri()`);const r=g(g(g(g({method:a,url:encodeURI(t),timeout:o||1e4},n&&{headers:n}),s&&{params:s}),l&&{auth:l}),c&&{data:c}),i=yield M.request(r),h=i.headers["last-modified"]?i.headers["last-modified"]:null;return g(g({},i.data),h&&{lastModified:h})}),oe=e=>{const{oauthUri:t,clientId:o,clientSecret:n}=e;return m({data:"grant_type=client_credentials",auth:{username:o,password:n},uri:t,method:"POST"})},re=Object.freeze({1:0,2:0,3:0,5:0}),ne=Object.freeze({1:Object.freeze(["en_US","es_MX","pt_BR"]),2:Object.freeze(["en_GB","es_ES","fr_FR","ru_RU","de_DE","pt_PT","it_IT"]),3:Object.freeze(["ko_KR","zh_TW"]),5:Object.freeze(["zh_CN"])}),se=Object.freeze({1:Object.freeze(["us"]),2:Object.freeze(["eu"]),3:Object.freeze(["kr","tw"]),5:Object.freeze(["cn"])}),ae=Object.freeze({1:Object.freeze([1,2]),2:Object.freeze([1,2]),3:Object.freeze([1,2]),5:Object.freeze([1])}),ce=Object.freeze({1:"https://us.api.blizzard.com",2:"https://eu.api.blizzard.com",3:["https://kr.api.blizzard.com","https://tw.api.blizzard.com/"],5:"https://gateway.battlenet.com.cn/"}),R=Object.freeze({1:"https://us.battle.net",2:"https://eu.battle.net",3:"https://apac.battle.net",5:"https://www.battlenet.com.cn"}),v=e=>Object.freeze({1:`${R[1]}${e}`,2:`${R[2]}${e}`,3:`${R[3]}${e}`,5:`${R[5]}${e}`}),ie="/oauth/authorize",le="/oauth/token",de="/oauth/check_token?token=",ue=v(ie),ge=v(le),fe=v(de),u={REGIONS:se,LOCALES:ne,DEFAULT_LOCALES:re,SC2_REALMS:ae,REGION_API_HOSTS:ce,OAUTH_AUTHORIZE_URIS:ue,OAUTH_TOKEN_URIS:ge,OAUTH_CHECK_TOKEN_URIS:fe},he=()=>u.REGIONS,Re=()=>Object.keys(u.REGIONS).map(t=>parseInt(t,10)),pe=()=>{const e=Object.values(u.REGIONS);return[].concat(...e).map(o=>o.toString())},O=e=>{const t=Object.keys(u.REGIONS),o=e.toString();if(!t.includes(o))throw new RangeError(`${o} is not a valid parameter for getRegionNameById()`);return u.REGIONS[o]},f=e=>{try{return Boolean(O(e))}catch(t){return!1}},S=e=>{const t=e.toLowerCase(),o=u.REGIONS,s=Object.keys(o).filter(l=>o[l].includes(t)),c=Number(s[0])||!1;if(!c)throw new RangeError(`"${e}" is not a valid parameter for getRegionIdByName()`);return c},k=e=>{try{return Boolean(S(e))}catch(t){return!1}},_=(e,t)=>{const o=typeof e!="string"?e:e.toString();if(!f(o))throw new RangeError(`${o} is not a valid parameter for getConstantByRegionId(${e}, '${t}')`);return u[t][o]},me=(e,t)=>{if(!k(e))throw new RangeError(`${e} is not a valid parameter for getConstantByRegionName(${e}, '${t}')`);const n=S(e);return u[t][n]},y=(e,t)=>f(e)?_(e,t):me(e.toString(),t),w=()=>u.LOCALES,E=()=>{const e=Object.values(u.LOCALES);return[].concat(...e).map(n=>n.toString())},T=e=>_(e,"LOCALES"),b=e=>/^(?:[a-z]{2}_[a-z]{2})$/gi.test(e),$=e=>{if(!b(e))throw new RangeError(`${e} is not a valid parameter for validateLocale()`);const o=E().map(s=>s.toLowerCase()),n=e.toLowerCase();return o.includes(n)},ve=(e,t)=>{const o=e.toLowerCase(),n=$(o)||!1,s=t.toString(),c=f(s);if(!n)throw new RangeError(`${e} is not a valid locale parameter for isLocaleValidForRegionId()`);if(!c)throw new RangeError(`${t} is not a valid regionId parameter for isLocaleValidForRegionId()`);return T(t).map(a=>a.toLowerCase()).includes(o)},P=e=>{const t=e.toString();if(!f(t))throw new RangeError(`${t} is not a valid parameter for getDefaultLocaleNameForRegionId()`);const n=u.DEFAULT_LOCALES[t];return u.LOCALES[e][n]},Se=()=>{const e=w(),t=Object.keys(e);return Object.assign({},...t.map(o=>({[o]:P(o)})))},_e=()=>u.SC2_REALMS,j=()=>{const e=Object.values(u.SC2_REALMS);return[].concat(...e).filter((o,n,s)=>n===s.indexOf(o))},z=e=>_(e,"SC2_REALMS"),A=e=>{const t=e.toString();return/^([1-9]{1})$/gi.test(t)},ye=e=>{if(!A(e))throw new RangeError(`${e} is not a valid parameter for validateSc2Realm()`);const o=j(),n=typeof e=="number"?e:parseInt(e,10);return o.includes(n)},Ae=(e,t)=>{const o=A(e),n=t.toString(),s=f(n);if(!o)throw new RangeError(`${e} is not a valid sc2Realm parameter for isSc2RealmValidForRegionId()`);if(!s)throw new RangeError(`${t} is not a valid regionId parameter for isSc2RealmValidForRegionId()`);const c=z(t),l=typeof e=="number"?e:parseInt(e,10);return c.includes(l)},Ie=e=>{const t=y(e,"REGION_API_HOSTS");return typeof e=="string"&&e.toLowerCase()==="kr"?t[0]:typeof e=="string"&&e.toLowerCase()==="tw"?t[1]:t},Le=e=>y(e,"OAUTH_CHECK_TOKEN_URIS"),Oe=e=>y(e,"OAUTH_TOKEN_URIS");var ke=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});const N=e=>ke(this,null,function*(){const{region:t,clientId:o,clientSecret:n}=e,s=Oe(t);return(yield oe({oauthUri:s,clientId:o,clientSecret:n})).access_token});var we=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});const V=(e,t)=>we(this,null,function*(){try{const n=`${Le(e)}${t}`,s=yield m({uri:n});return!(s.error&&s.error==="invalid_token")}catch(o){return!1}});var Ee=Object.defineProperty,Te=Object.prototype.hasOwnProperty,C=Object.getOwnPropertySymbols,be=Object.prototype.propertyIsEnumerable,U=(e,t,o)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))Te.call(t,o)&&U(e,o,t[o]);if(C)for(var o of C(t))be.call(t,o)&&U(e,o,t[o]);return e},$e=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});const B=(e,t)=>{const{region:o,endpoint:n,options:s}=e,{headers:c,params:l,timeout:a}=s;if(!X(n))throw new RangeError(`${n} is not a valid endpoint.`);const h=`${Ie(o)}${n}`,K={Authorization:`Bearer ${t}`},D=p(p({},c),K);return m(p(p({uri:h,method:"GET",headers:D},l&&{params:l}),a&&{timeout:a}))},Pe=e=>$e(this,null,function*(){const{region:t,accessToken:o}=e,{validateAccessTokenOnEachQuery:n,refreshExpiredAccessToken:s,onAccessTokenExpired:c,onAccessTokenRefresh:l}=e.options;if(n&&!(yield V(t,o)))return{error:"access_token_invalid"};try{return yield B(e,o)}catch(a){if(a.response&&a.response.status===401){if(c==null||c(),s){const r=yield N(e);return l==null||l(r),B(e,r)}return Promise.resolve({error:"access_token_invalid"})}throw a}});class je{constructor(t,o){this.clientId=t,this.clientSecret=o}}var ze=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});class x extends je{constructor(t){super(t.clientId,t.clientSecret);this.getAccessToken=()=>this.accessToken||this.setAccessToken(),this.setAccessToken=()=>ze(this,null,function*(){return this.accessToken=yield N({region:this.region,clientId:this.clientId,clientSecret:this.clientSecret}),this.accessToken}),this.region=t.region,this.accessToken=t.accessToken||void 0}}x.validateAccessToken=(e,t)=>V(e,t);var Ne=Object.defineProperty,Ve=Object.prototype.hasOwnProperty,F=Object.getOwnPropertySymbols,Ce=Object.prototype.propertyIsEnumerable,H=(e,t,o)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,G=(e,t)=>{for(var o in t||(t={}))Ve.call(t,o)&&H(e,o,t[o]);if(F)for(var o of F(t))Ce.call(t,o)&&H(e,o,t[o]);return e},Ue=(e,t,o)=>new Promise((n,s)=>{var c=r=>{try{a(o.next(r))}catch(i){s(i)}},l=r=>{try{a(o.throw(r))}catch(i){s(i)}},a=r=>r.done?n(r.value):Promise.resolve(r.value).then(c,l);a((o=o.apply(e,t)).next())});class d extends x{constructor(t){super({region:t.region,clientId:t.clientId,clientSecret:t.clientSecret,accessToken:t.accessToken});this.query=(o,n)=>Ue(this,null,function*(){return Pe({endpoint:o,region:this.region,clientId:this.clientId,clientSecret:this.clientSecret,accessToken:yield this.getAccessToken(),options:G(G({},this.options),n)})}),this.options={validateAccessTokenOnEachQuery:t.validateAccessTokenOnEachQuery||!1,refreshExpiredAccessToken:t.refreshExpiredAccessToken||!1,onAccessTokenExpired:t.onAccessTokenExpired||void 0,onAccessTokenRefresh:t.onAccessTokenRefresh||void 0}}}d.getAllRegions=he,d.getAllRegionIds=Re,d.getAllRegionNames=pe,d.getRegionNameById=O,d.validateRegionId=f,d.getRegionIdByName=S,d.validateRegionName=k,d.getAllLocales=w,d.getAllLocaleNames=E,d.getLocalesByRegionId=T,d.checkIfLocaleLooksValid=b,d.validateLocale=$,d.isLocaleValidForRegionId=ve,d.getAllSc2Realms=_e,d.getAllAvailableSc2Realms=j,d.getSc2RealmsByRegionId=z,d.checkIfSc2RealmLooksValid=A,d.validateSc2Realm=ye,d.isSc2RealmValidForRegionId=Ae,d.getDefaultLocaleNameForRegionId=P,d.getAllDefaultLocaleNames=Se;export{d as BlizzAPI};
