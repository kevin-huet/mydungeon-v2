(function(f,p){typeof exports=="object"&&typeof module!="undefined"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(f=typeof globalThis!="undefined"?globalThis:f||self,p(f.BlizzAPI={}))})(this,function(f){"use strict";const M=[e=>e[0]==="/",e=>e.length>3],W=e=>M.every(t=>t(e)),q=e=>/(?:http[s]?:\/\/)[^\s(["<,>]*\.[^\s[",><]*/gm.test(e);var Q=Object.defineProperty,X=Object.prototype.hasOwnProperty,O=Object.getOwnPropertySymbols,Z=Object.prototype.propertyIsEnumerable,k=(e,t,o)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))X.call(t,o)&&k(e,o,t[o]);if(O)for(var o of O(t))Z.call(t,o)&&k(e,o,t[o]);return e},J=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});const _=e=>J(this,null,function*(){const{uri:t,timeout:o,headers:s,params:r,data:c,auth:l}=e,a=e.method||"GET";if(!q(t))throw new RangeError(`'${t}' is not a valid parameter for fetchFromUri()`);const n=g(g(g(g({method:a,url:encodeURI(t),timeout:o||1e4},s&&{headers:s}),r&&{params:r}),l&&{auth:l}),c&&{data:c}),i=yield axios.request(n),v=i.headers["last-modified"]?i.headers["last-modified"]:null;return g(g({},i.data),v&&{lastModified:v})}),Y=e=>{const{oauthUri:t,clientId:o,clientSecret:s}=e;return _({data:"grant_type=client_credentials",auth:{username:o,password:s},uri:t,method:"POST"})},ee=Object.freeze({1:0,2:0,3:0,5:0}),te=Object.freeze({1:Object.freeze(["en_US","es_MX","pt_BR"]),2:Object.freeze(["en_GB","es_ES","fr_FR","ru_RU","de_DE","pt_PT","it_IT"]),3:Object.freeze(["ko_KR","zh_TW"]),5:Object.freeze(["zh_CN"])}),oe=Object.freeze({1:Object.freeze(["us"]),2:Object.freeze(["eu"]),3:Object.freeze(["kr","tw"]),5:Object.freeze(["cn"])}),ne=Object.freeze({1:Object.freeze([1,2]),2:Object.freeze([1,2]),3:Object.freeze([1,2]),5:Object.freeze([1])}),se=Object.freeze({1:"https://us.api.blizzard.com",2:"https://eu.api.blizzard.com",3:["https://kr.api.blizzard.com","https://tw.api.blizzard.com/"],5:"https://gateway.battlenet.com.cn/"}),R=Object.freeze({1:"https://us.battle.net",2:"https://eu.battle.net",3:"https://apac.battle.net",5:"https://www.battlenet.com.cn"}),y=e=>Object.freeze({1:`${R[1]}${e}`,2:`${R[2]}${e}`,3:`${R[3]}${e}`,5:`${R[5]}${e}`}),re="/oauth/authorize",ae="/oauth/token",ce="/oauth/check_token?token=",ie=y(re),le=y(ae),de=y(ce),u={REGIONS:oe,LOCALES:te,DEFAULT_LOCALES:ee,SC2_REALMS:ne,REGION_API_HOSTS:se,OAUTH_AUTHORIZE_URIS:ie,OAUTH_TOKEN_URIS:le,OAUTH_CHECK_TOKEN_URIS:de},ue=()=>u.REGIONS,fe=()=>Object.keys(u.REGIONS).map(t=>parseInt(t,10)),ge=()=>{const e=Object.values(u.REGIONS);return[].concat(...e).map(o=>o.toString())},w=e=>{const t=Object.keys(u.REGIONS),o=e.toString();if(!t.includes(o))throw new RangeError(`${o} is not a valid parameter for getRegionNameById()`);return u.REGIONS[o]},h=e=>{try{return Boolean(w(e))}catch(t){return!1}},S=e=>{const t=e.toLowerCase(),o=u.REGIONS,r=Object.keys(o).filter(l=>o[l].includes(t)),c=Number(r[0])||!1;if(!c)throw new RangeError(`"${e}" is not a valid parameter for getRegionIdByName()`);return c},E=e=>{try{return Boolean(S(e))}catch(t){return!1}},A=(e,t)=>{const o=typeof e!="string"?e:e.toString();if(!h(o))throw new RangeError(`${o} is not a valid parameter for getConstantByRegionId(${e}, '${t}')`);return u[t][o]},he=(e,t)=>{if(!E(e))throw new RangeError(`${e} is not a valid parameter for getConstantByRegionName(${e}, '${t}')`);const s=S(e);return u[t][s]},I=(e,t)=>h(e)?A(e,t):he(e.toString(),t),T=()=>u.LOCALES,b=()=>{const e=Object.values(u.LOCALES);return[].concat(...e).map(s=>s.toString())},P=e=>A(e,"LOCALES"),$=e=>/^(?:[a-z]{2}_[a-z]{2})$/gi.test(e),z=e=>{if(!$(e))throw new RangeError(`${e} is not a valid parameter for validateLocale()`);const o=b().map(r=>r.toLowerCase()),s=e.toLowerCase();return o.includes(s)},pe=(e,t)=>{const o=e.toLowerCase(),s=z(o)||!1,r=t.toString(),c=h(r);if(!s)throw new RangeError(`${e} is not a valid locale parameter for isLocaleValidForRegionId()`);if(!c)throw new RangeError(`${t} is not a valid regionId parameter for isLocaleValidForRegionId()`);return P(t).map(a=>a.toLowerCase()).includes(o)},j=e=>{const t=e.toString();if(!h(t))throw new RangeError(`${t} is not a valid parameter for getDefaultLocaleNameForRegionId()`);const s=u.DEFAULT_LOCALES[t];return u.LOCALES[e][s]},Re=()=>{const e=T(),t=Object.keys(e);return Object.assign({},...t.map(o=>({[o]:j(o)})))},me=()=>u.SC2_REALMS,N=()=>{const e=Object.values(u.SC2_REALMS);return[].concat(...e).filter((o,s,r)=>s===r.indexOf(o))},V=e=>A(e,"SC2_REALMS"),L=e=>{const t=e.toString();return/^([1-9]{1})$/gi.test(t)},ve=e=>{if(!L(e))throw new RangeError(`${e} is not a valid parameter for validateSc2Realm()`);const o=N(),s=typeof e=="number"?e:parseInt(e,10);return o.includes(s)},_e=(e,t)=>{const o=L(e),s=t.toString(),r=h(s);if(!o)throw new RangeError(`${e} is not a valid sc2Realm parameter for isSc2RealmValidForRegionId()`);if(!r)throw new RangeError(`${t} is not a valid regionId parameter for isSc2RealmValidForRegionId()`);const c=V(t),l=typeof e=="number"?e:parseInt(e,10);return c.includes(l)},ye=e=>{const t=I(e,"REGION_API_HOSTS");return typeof e=="string"&&e.toLowerCase()==="kr"?t[0]:typeof e=="string"&&e.toLowerCase()==="tw"?t[1]:t},Se=e=>I(e,"OAUTH_CHECK_TOKEN_URIS"),Ae=e=>I(e,"OAUTH_TOKEN_URIS");var Ie=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});const C=e=>Ie(this,null,function*(){const{region:t,clientId:o,clientSecret:s}=e,r=Ae(t);return(yield Y({oauthUri:r,clientId:o,clientSecret:s})).access_token});var Le=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});const U=(e,t)=>Le(this,null,function*(){try{const s=`${Se(e)}${t}`,r=yield _({uri:s});return!(r.error&&r.error==="invalid_token")}catch(o){return!1}});var Oe=Object.defineProperty,ke=Object.prototype.hasOwnProperty,B=Object.getOwnPropertySymbols,we=Object.prototype.propertyIsEnumerable,x=(e,t,o)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))ke.call(t,o)&&x(e,o,t[o]);if(B)for(var o of B(t))we.call(t,o)&&x(e,o,t[o]);return e},Ee=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});const F=(e,t)=>{const{region:o,endpoint:s,options:r}=e,{headers:c,params:l,timeout:a}=r;if(!W(s))throw new RangeError(`${s} is not a valid endpoint.`);const v=`${ye(o)}${s}`,Ve={Authorization:`Bearer ${t}`},Ce=m(m({},c),Ve);return _(m(m({uri:v,method:"GET",headers:Ce},l&&{params:l}),a&&{timeout:a}))},Te=e=>Ee(this,null,function*(){const{region:t,accessToken:o}=e,{validateAccessTokenOnEachQuery:s,refreshExpiredAccessToken:r,onAccessTokenExpired:c,onAccessTokenRefresh:l}=e.options;if(s&&!(yield U(t,o)))return{error:"access_token_invalid"};try{return yield F(e,o)}catch(a){if(a.response&&a.response.status===401){if(c==null||c(),r){const n=yield C(e);return l==null||l(n),F(e,n)}return Promise.resolve({error:"access_token_invalid"})}throw a}});class be{constructor(t,o){this.clientId=t,this.clientSecret=o}}var Pe=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});class H extends be{constructor(t){super(t.clientId,t.clientSecret);this.getAccessToken=()=>this.accessToken||this.setAccessToken(),this.setAccessToken=()=>Pe(this,null,function*(){return this.accessToken=yield C({region:this.region,clientId:this.clientId,clientSecret:this.clientSecret}),this.accessToken}),this.region=t.region,this.accessToken=t.accessToken||void 0}}H.validateAccessToken=(e,t)=>U(e,t);var $e=Object.defineProperty,ze=Object.prototype.hasOwnProperty,G=Object.getOwnPropertySymbols,je=Object.prototype.propertyIsEnumerable,K=(e,t,o)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,D=(e,t)=>{for(var o in t||(t={}))ze.call(t,o)&&K(e,o,t[o]);if(G)for(var o of G(t))je.call(t,o)&&K(e,o,t[o]);return e},Ne=(e,t,o)=>new Promise((s,r)=>{var c=n=>{try{a(o.next(n))}catch(i){r(i)}},l=n=>{try{a(o.throw(n))}catch(i){r(i)}},a=n=>n.done?s(n.value):Promise.resolve(n.value).then(c,l);a((o=o.apply(e,t)).next())});class d extends H{constructor(t){super({region:t.region,clientId:t.clientId,clientSecret:t.clientSecret,accessToken:t.accessToken});this.query=(o,s)=>Ne(this,null,function*(){return Te({endpoint:o,region:this.region,clientId:this.clientId,clientSecret:this.clientSecret,accessToken:yield this.getAccessToken(),options:D(D({},this.options),s)})}),this.options={validateAccessTokenOnEachQuery:t.validateAccessTokenOnEachQuery||!1,refreshExpiredAccessToken:t.refreshExpiredAccessToken||!1,onAccessTokenExpired:t.onAccessTokenExpired||void 0,onAccessTokenRefresh:t.onAccessTokenRefresh||void 0}}}d.getAllRegions=ue,d.getAllRegionIds=fe,d.getAllRegionNames=ge,d.getRegionNameById=w,d.validateRegionId=h,d.getRegionIdByName=S,d.validateRegionName=E,d.getAllLocales=T,d.getAllLocaleNames=b,d.getLocalesByRegionId=P,d.checkIfLocaleLooksValid=$,d.validateLocale=z,d.isLocaleValidForRegionId=pe,d.getAllSc2Realms=me,d.getAllAvailableSc2Realms=N,d.getSc2RealmsByRegionId=V,d.checkIfSc2RealmLooksValid=L,d.validateSc2Realm=ve,d.isSc2RealmValidForRegionId=_e,d.getDefaultLocaleNameForRegionId=j,d.getAllDefaultLocaleNames=Re,f.BlizzAPI=d,Object.defineProperty(f,"__esModule",{value:!0})});
